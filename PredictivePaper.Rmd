---
title: "Predictive Analytics"
output:
  html_document: default
  html_notebook: default
  word_document: default
---

Sigco, Inc is a glass and architectural metal fabricator/distributor in Westbrook, ME and serves much New England. They manufacture a number of glass products and think the demand for these products is seasonal. 

Inventory management is a major challenge. It is predominantly manual - inventory is counted three times a week to ensure accuracy, demand is forecasted just one week in advance and quantities to order for replenishment (including safety stock levels) are very subjective.  In particular, safety stock is computed by assigning an extra percentage of product to keep on hand of some of the products, but not all, and the percentage used varies by product. There is opportunity for analysis and improvement in the forecasting of demand using historical seasonal data.  Further, safety stock could be calculated to ensure greater efficiency of their inventory - maintaining or improving their service level while minimizing too much stock on hand.

The **goal** of this project is to build a systematic forecasting model evaluation tool for the company to use in its calculations for safety stock and reorder points using the EOQ model. An interactive forecasting tool, such as an R Shiny app, provides a simple means for management to upload data sets, visualize the historical use of products in graphical form, determine components inherent in the data, partition the data into training and validation sets, run a few different fit models , evaluate the performance of the models, choose the best model to deploy a forecast, and use that forecast in the calculation of the safety stock and reorder points. 

**Everything we do in the class relies on data, where and how do you expect to obtain the necessary time series data to utilize the tools and models we covered in class?** 

The data is easy to come by. The historical use of each item is documented on annual Excel spreadsheets that the company keeps. There are roughly 200 SKUs in Sigco's inventory, and I have chosen to look at the 25 most utilized items and forecast their use. 

**Step 1**

Visualization

Import the company spreadsheets into R, clean them up, and combine them into a single time series data set starting from January, 2012. Not all items have been in the company's inventory since then, but the majority have. 


```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(knitr)
library(dplyr)
library(tidyr)
library(forecast)
library(pander)
library(reshape2)
library(zoo)
```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
Stock12 <- read.csv("Inventory12.csv", header = T, stringsAsFactors = F)
Stock12 <- Stock12 %>% select(-Description)
names(Stock12) <- c("Item_Code", "01-12", "02-12", "03-12", "04-12", "05-12", "06-12", "07-12", "08-12", "09-12", "10-12", "11-12", "12-12")
Stock12 <- gather(Stock12, Month, Used,c(2:13))
ItemstoUse <-  c("SS06CLR96130","SS03CLR96130" , "SS12CLR102130", "SS02CLR7284", "SS06S6T100144", "SS10CLR96130", "SS05CLR96130", "SS06MCL96130", "SS06S6A100144" , "SS10SHG96130", "SS03LOE7284", "SS03LOE728", "SS03S6T7284", "SS04CLR96130", "SS06LOE96130", "SS02LOE7284", "SS06S7T100144", "SS05S6T96130", "SS06BRN96130","SS06GRY96130","SS06STP96130","SS03S6A7284","SS10SUW96130","SS0LCLR7284","SS05LOE96130","SS12SHG96130","SS06STC102144","SS12STP96130","SS06S6G96130","SS10STP96130")
Stock12 <- Stock12 %>% filter(Item_Code %in% ItemstoUse)
#pander(head(Stock12))
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
Stock13 <- read.csv("Inventory13.csv", header = T, stringsAsFactors = F)
Stock13 <- Stock13 %>% select(-Description)
names(Stock13) <- c("Item_Code", "01-13", "02-13", "03-13", "04-13", "05-13", "06-13", "07-13", "08-13", "09-13", "10-13", "11-13", "12-13")
Stock13 <- gather(Stock13, Month, Used,c(2:13))
Stock13 <- Stock13 %>% filter(Item_Code %in% ItemstoUse)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#wide to long 2014
Stock14 <- read.csv("Inventory14.csv", header = T, stringsAsFactors = F)
Stock14 <- Stock14 %>% select(-Description)
names(Stock14) <- c("Item_Code", "01-14", "02-14", "03-14", "04-14", "05-14", "06-14", "07-14", "08-14", "09-14", "10-14", "11-14", "12-14")
Stock14 <- gather(Stock14, Month, Used,c(2:13))
Stock14 <- Stock14 %>% filter(Item_Code %in% ItemstoUse)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#wide to long 2015
Stock15 <- read.csv("Inventory15.csv", header = T, stringsAsFactors = F)
Stock15 <- Stock15[-1,]
Stock15 <- Stock15 %>% select(-Description)
names(Stock15) <- c("Item_Code", "01-15", "02-15", "03-15", "04-15", "05-15", "06-15", "07-15", "08-15", "09-15", "10-15", "11-15", "12-15")
Stock15 <- gather(Stock15, Month, Used,c(2:13))
Stock15 <- Stock15 %>% filter(Item_Code %in% ItemstoUse)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
Stock16 <- read.csv("Inventory16.csv", header = T, stringsAsFactors = F)
Stock16 <- Stock16[-1,]
Stock16 <- Stock16 %>% select(-Description)
names(Stock16) <- c("Item_Code", "01-16", "02-16", "03-16", "04-16", "05-16", "06-16", "07-16", "08-16", "09-16", "10-16", "11-16", "12-16")
Stock16 <- gather(Stock16, Month, Used,c(2:13))
Stock16 <- Stock16 %>% filter(Item_Code %in% ItemstoUse)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
Stock17 <- read.csv("Inventory17.csv", header = T, stringsAsFactors = F)
Stock17 <- Stock17 %>% select(-Description)
names(Stock17) <- c("Item_Code", "01-17", "02-17", "03-17", "04-17")
Stock17 <- gather(Stock17, Month, Used,c(2:5))
Stock17 <- Stock17 %>% filter(Item_Code %in% ItemstoUse)
```

The final data set will look something like this: 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
x <- rbind.data.frame(Stock12, Stock13, Stock14, Stock15, Stock16, Stock17)
x[x == 0] <- NA
kable(head(x, 20))
```

**Step 2**

Visualize the data. I have chosen 6 different Items for brevity's sake, I'll narrow the scope to SKU numbers SS06S6T100144, SS10CLR96130,SS06S6A100144, SS03S6T7284, SS04CLR96130, SS06BRN96130. I will refer to them as E, F, I, M, N, and S respectively.   

```{r, message=FALSE, warning=FALSE, include=FALSE}
a <- x %>% filter(Item_Code == "SS06CLR96130")
a$Used <- as.numeric(a$Used)
a.ts <- ts(a$Used, start = c(2012,1), frequency = 12)
ggseasonplot(a.ts)
```

```{r, echo=FALSE, warning=FALSE}
validLength <- 4
trainLength <- length(a.ts) - validLength
salesTrain <- window(a.ts, end = c(2012, trainLength))
salesValid <- window(a.ts, start = c(2012, trainLength + 1))
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
b <- x %>% filter(Item_Code == "SS02LOE7284")
b$Used <- as.numeric(b$Used)
b.ts <- ts(b$Used, start = c(2012,1), frequency = 12)

```


```{r, message=FALSE, warning=FALSE, include=FALSE}
#out of use
c <- x %>% filter(Item_Code == "SS03CLR96130")
c$Used <- as.numeric(c$Used)
c.ts <- ts(c$Used, start = c(2012,1), frequency = 12)

```

```{r clearly seasonal, message=FALSE, warning=FALSE, include=FALSE}
d <- x %>% filter(Item_Code == "SS02CLR7284")
d$Used <- as.numeric(d$Used)
d.ts <- ts(d$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
e <- x %>% filter(Item_Code == "SS06S6T100144")
e$Used <- as.numeric(e$Used)
e.ts <- ts(e$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
f <- x %>% filter(Item_Code == "SS10CLR96130")
f$Used <- as.numeric(f$Used)
f.ts <- ts(f$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
g <- x %>% filter(Item_Code == "SS05CLR96130")
g$Used <- as.numeric(g$Used)
g.ts <- ts(g$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
h <- x %>% filter(Item_Code == "SS06MCL96130")
h$Used <- as.numeric(h$Used)
h.ts <- ts(h$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
i <- x %>% filter(Item_Code == "SS06S6A100144")
i$Used <- as.numeric(i$Used)
i.ts <- ts(i$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
j <- x %>% filter(Item_Code == "SS10SHG96130")
j$Used <- as.numeric(j$Used)
j.ts <- ts(j$Used, start = c(2012,1), frequency = 12)

```



```{r, message=FALSE, warning=FALSE, include=FALSE}
k <- x %>% filter(Item_Code == "SS12CLR102130")
k$Used <- as.numeric(k$Used)
k.ts <- ts(k$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
l <- x %>% filter(Item_Code == "SS03LOE7284")
l$Used <- as.numeric(l$Used)
l.ts <- ts(l$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
m <- x %>% filter(Item_Code == "SS03S6T7284")
m$Used <- as.numeric(m$Used)
m.ts <- ts(m$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
n <- x %>% filter(Item_Code == "SS04CLR96130")
n$Used <- as.numeric(n$Used)
n.ts <- ts(n$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}

o <- x %>% filter(Item_Code == "SS06LOE96130")
o$Used <- as.numeric(o$Used)
o.ts <- ts(o$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
p <- x %>% filter(Item_Code == "SS02LOE7284")
p$Used <- as.numeric(p$Used)
p.ts <- ts(p$Used, start = c(2012,1), frequency = 12)


```

```{r, message=FALSE, warning=FALSE, include=FALSE}
q <- x %>% filter(Item_Code == "SS06S7T100144")
q$Used <- as.numeric(q$Used)
q.ts <- ts(q$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
r <- x %>% filter(Item_Code == "SS05S6T96130")
r$Used <- as.numeric(r$Used)
r.ts <- ts(r$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
s <- x %>% filter(Item_Code == "SS06BRN96130")
s$Used <- as.numeric(s$Used)
s.ts <- ts(s$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
t <- x %>% filter(Item_Code == "SS06GRY96130")
t$Used <- as.numeric(t$Used)
t.ts <- ts(t$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
u <- x %>% filter(Item_Code == "SS06STP96130")
u$Used <- as.numeric(u$Used)
u.ts <- ts(u$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
v <- x %>% filter(Item_Code == "SS03S6A7284")
v$Used <- as.numeric(v$Used)
v.ts <- ts(v$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
w <- x %>% filter(Item_Code == "SS10SUW96130")
w$Used <- as.numeric(w$Used)
w.ts <- ts(w$Used, start = c(2012,1), frequency = 12)
```

```{r, message=FALSE, warning=FALSE, include=FALSE}
xx <- x %>% filter(Item_Code == "SS0LCLR7284")
xx$Used <- as.numeric(xx$Used)
xx.ts <- ts(xx$Used, start = c(2012,1), frequency = 12)
```

```{r, message=FALSE, warning=FALSE, include=FALSE}
y <- x %>% filter(Item_Code == "SS05LOE96130")
y$Used <- as.numeric(y$Used)
y.ts <- ts(y$Used, start = c(2013,10), frequency = 12)


```


```{r, message=FALSE, warning=FALSE, include=FALSE}
z <- x %>% filter(Item_Code == "SS12SHG96130")
z$Used <- as.numeric(z$Used)
z.ts <- ts(z$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
aa <- x %>% filter(Item_Code == "SS06STC102144")
aa$Used <- as.numeric(aa$Used)
aa.ts <- ts(aa$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
bb <- x %>% filter(Item_Code == "SS12STP96130")
bb$Used <- as.numeric(bb$Used)
bb.ts <- ts(bb$Used, start = c(2012,1), frequency = 12)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
cc <- x %>% filter(Item_Code == "SS06S6G96130")
cc$Used <- as.numeric(cc$Used)
cc.ts <- ts(cc$Used, start = c(2012,1), frequency = 12)

```


```{r, message=FALSE, warning=FALSE, include=FALSE}
dd <- x %>% filter(Item_Code == "SS10STP96130")
dd$Used <- as.numeric(dd$Used)
dd.ts <- ts(dd$Used, start = c(2012,1), frequency = 12)


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
par(mfrow = c(2,3))
plot(e.ts, main = "SS06S6T100144")
plot(f.ts, main = "SS10CLR96130")
plot(i.ts, main = "SS06S6A100144")
plot(m.ts, main = "SS03S6T7284")
plot(n.ts, main = "SS04CLR96130")
plot(s.ts, main = "SS06BRN96130")
# 
# par(mfrow = c(2,3))
# plot(m.ts)
# plot(n.ts)
# plot(g.ts)
# plot(i.ts)
# plot(j.ts)
# plot(s.ts)
# 
# par(mfrow = c(2,3))
# plot(t.ts)
# plot(u.ts)
# plot(p.ts)
# plot(q.ts)
# plot(r.ts)
# plot(dd.ts)
# 
# par(mfrow = c(2,3))
# plot(v.ts)
# plot(w.ts)
# plot(z.ts)
# plot(bb.ts)
# plot(l.ts)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#colors <- rainbow(6, start = .7, end = 0.9)

# par(mfrow = c(2,3))
# 
# seasonplot(m.ts, col = colors)
# seasonplot(n.ts, col = colors)
# seasonplot(g.ts, col = colors)
# seasonplot(i.ts, col = colors)
# seasonplot(j.ts, col = colors)
# seasonplot(s.ts, col = colors)
# 
# par(mfrow = c(2,3))
# 
# seasonplot(t.ts, col = colors)
# seasonplot(u.ts, col = colors)
# seasonplot(p.ts, col = colors)
# seasonplot(q.ts, col = colors)
# seasonplot(r.ts, col = colors)
# seasonplot(dd.ts, col = colors)
# 
# par(mfrow = c(2,3))
# 
# seasonplot(v.ts, col = colors)
# seasonplot(w.ts, col = colors)
# seasonplot(z.ts, col = colors)
# seasonplot(bb.ts, col = colors)
# seasonplot(l.ts, col = colors)
```

I chose these particular SKUs because, as a group, I can illustrate how the company can model data that exhibits differing components. None of the items are simple to model and they each each exhibit non-stationarity. They have varying degrees of seasonality and trend. 

**Seasonality**

Below I show each of the SKU items plotted. The first group are seasonal charts where the months of the year are plotted on the x axis and each colored line represents sales in the data series. We can see varying degrees of seasonality. 


```{r, echo=FALSE, message=FALSE, warning=FALSE}
colors <- c("violetred", "turquoise3", "tomato", "skyblue2", "seagreen3","goldenrod1" )


par(mfrow = c(2,3))
seasonplot(e.ts, col = colors, main = "SS06S6T100144")
seasonplot(f.ts, col = colors, main = "SS10CLR96130")
seasonplot(i.ts, col = colors, main = "SS06S6A100144")
seasonplot(m.ts, col = colors, main = "SS03S6T7284")
seasonplot(n.ts, col = colors, main = "SS04CLR96130")
seasonplot(s.ts, col = colors, main = "SS06BRN96130")
```

The six plots below show seasonality differently, with the years represented on the x axis and each line represents the sales in the each month.  

```{r, echo=FALSE, message=FALSE, warning=FALSE}
par(mfrow = c(1,2))
xrange <- c(1,7)
yrange <- c(0,1000)

plot(xrange, yrange, type = "n", xlab = "Year", ylab = "Inventory Used", bty = "l")
colors <- rainbow(12)
linetype <- 1

for(i in 1:12){

  currentMonth <- subset(e.ts, cycle(e.ts) == i)
  lines(currentMonth, type = "l", lwd = 1,
       
  col =colors[i]
 
  )
}
title("Item E - Inventory Used \nBroken out by Month ")

xrange <- c(1,7)
yrange <- c(100,600)

plot(xrange, yrange, type = "n", xlab = "Year", ylab = "Inventory Used", bty = "l")
colors <- rainbow(12)
linetype <- 1

for(i in 1:12){

  currentMonth <- subset(f.ts, cycle(f.ts) == i)
  lines(currentMonth, type = "l", lwd = 1,
       
  col =colors[i]
 
  )
}
title("Item F - Inventory Used \nBroken out by Month ")

legend(6.5,600, 1:12, cex = 0.8, col = colors,lty = linetype, title = "Month", xpd = NA, bty = "n")


par(mfrow = c(1,2))
xrange <- c(1,7)
yrange <- c(0,400)

plot(xrange, yrange, type = "n", xlab = "Year", ylab = "Inventory Used", bty = "l")
colors <- rainbow(12)
linetype <- 1


for(i in 1:12){

  currentMonth <- subset(i.ts, cycle(i.ts) == i)
  lines(currentMonth, type = "l", lwd = 1,
       
  col =colors[i]
 
  )
}
title("Item I - Inventory Used \nBroken out by Month ")


xrange <- c(1,7)
yrange <- c(0,250)

plot(xrange, yrange, type = "n", xlab = "Year", ylab = "Inventory Used", bty = "l")
colors <- rainbow(12)
linetype <- 1

for(i in 1:12){

  currentMonth <- subset(m.ts, cycle(m.ts) == i)
  lines(currentMonth, type = "l", lwd = 1,
       
  col =colors[i]
 
  )
}
title("Item M - Inventory Used \nBroken out by Month ")
legend(6.5,250, 1:12, cex = 0.8, col = colors,lty = linetype, title = "Month", xpd = NA, bty = "n")


xrange <- c(1,7)
yrange <- c(100,400)

plot(xrange, yrange, type = "n", xlab = "Year", ylab = "Inventory Used", bty = "l")
colors <- rainbow(12)
linetype <- 1

for(i in 1:12){

  currentMonth <- subset(n.ts, cycle(n.ts) == i)
  lines(currentMonth, type = "l", lwd = 1,
       
  col =colors[i]
 
  )
}
title("Item N - Inventory Used \nBroken out by Month ")




xrange <- c(1,7)
yrange <- c(0,200)

plot(xrange, yrange, type = "n", xlab = "Year", ylab = "Inventory Used", bty = "l")
colors <- rainbow(12)
linetype <- 1

for(i in 1:12){

  currentMonth <- subset(s.ts, cycle(s.ts) == i)
  lines(currentMonth, type = "l", lwd = 1,
       
  col =colors[i]
 
  )
}
title("Item S - Inventory Used \nBroken out by Month ")

legend(6.5,175, 1:12, cex = 0.8, col = colors,lty = linetype, title = "Month", xpd = NA, bty = "n")
```

**Trend**

Trend can be visualized in the plots below. 

```{r, message=FALSE, warning=FALSE, include=FALSE}
LinearE <- tslm(e.ts ~ trend)
polyLinearE <- tslm(e.ts ~ trend + I(trend^2))
#seasonality does not show much significance
seasonTrendE <- tslm(e.ts ~ trend + season)
LinearF <- tslm(f.ts ~ trend)
polyLinearF <- tslm(f.ts ~ trend + I(trend^2))
seasonTrendF <- tslm(f.ts ~ trend + season)
LinearI <- tslm(i.ts ~ trend)
polyLinearI <- tslm(i.ts ~ trend + I(trend^2))
seasonTrendI <- tslm(i.ts ~ trend + season)
LinearM <- tslm(m.ts ~ trend)
polyLinearM <- tslm(m.ts ~ trend + I(trend^2))
seasonTrendM <- tslm(m.ts ~ trend + season)
LinearN <- tslm(n.ts ~ trend)
polyLinearN <- tslm(n.ts ~ trend + I(trend^2))
seasonTrendN <- tslm(n.ts ~ trend + season)
LinearS <- tslm(s.ts ~ trend)
polyLinearS <- tslm(s.ts ~ trend + I(trend^2))
seasonTrendS <- tslm(s.ts ~ trend + season)


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
par(mfrow = c(1,2))

plot(e.ts, main = "Monthly Use Item E \nTrend and Seasonality", bty = "l")
lines(LinearF$fitted, col = "blue", lwd = 2)
lines(polyLinearE$fitted, col = "green", lwd = 2)
lines(seasonTrendE$fitted, col = "orange", lwd = 2)
legend(2012, 850, c("L", "Q", "S"), lty = c(1,1,1), lwd = c(2,2,2), col = c("blue", "green", "orange"), bty = "n" )

plot(f.ts, main = "Monthly Use Item F \nTrend and Seasonality", bty = "l")
lines(LinearF$fitted, col = "blue", lwd = 2)
lines(polyLinearF$fitted, col = "green", lwd = 2)
lines(seasonTrendF$fitted, col = "orange", lwd = 2)
legend(2012, 600, c("L", "Q", "S"), lty = c(1,1,1), lwd = c(2,2,2), col = c("blue", "green", "orange"), bty = "n" )

par(mfrow = c(1,2))
plot(i.ts,main = "Monthly Use Item I \nTrend and Seasonality", bty = "l")
lines(LinearI$fitted, col = "blue", lwd = 2)
lines(polyLinearI$fitted, col = "green", lwd = 2)
lines(seasonTrendI$fitted, col = "orange", lwd = 2)
legend(2012, 425, c("L", "Q", "S"), 
       lty = c(1,1,1), lwd = c(2,2,2), 
       col = c("blue", "green", "orange"), bty = "n" )

plot(m.ts, main = "Monthly Use Item M \nTrend and Seasonality", bty = "l")
lines(LinearM$fitted, col = "blue", lwd = 2)
lines(polyLinearM$fitted, col = "green", lwd = 2)
lines(seasonTrendM$fitted, col = "orange", lwd = 2)
legend(2012, 220, c("L", "Q", "S"), lty = c(1,1,1), lwd = c(2,2,2), col = c("blue", "green", "orange"), bty = "n" )

par(mfrow = c(1,2))

plot(n.ts, main = "Monthly Use Item N \nTrend and Seasonality", bty = "l", xlim = c(2012,2018))
lines(LinearN$fitted, col = "blue", lwd = 2)
lines(polyLinearN$fitted, col = "green", lwd = 2)
lines(seasonTrendN$fitted, col = "orange", lwd = 2)
legend(2012, 380, c("L", "Q", "S"), lty = c(1,1,1), lwd = c(2,2,2), col = c("blue", "green", "orange"), bty = "n" )



plot(s.ts, main = "Monthly Use Item S \nTrend and Seasonality", bty = "l")
lines(LinearS$fitted, col = "blue", lty = 1,lwd = 2)
lines(polyLinearS$fitted, col = "green", lty = 1,lwd = 2)
lines(seasonTrendS$fitted, col = "orange", lty = 1,lwd = 2)
legend(2012, 200, c("L", "Q", "S"), 
       lty = c(1,1,1), lwd = c(2,2,2), 
       col = c("blue", "green", "orange"), bty = "n" )


```

Finally, we can get an idea if seasonality and/or trend are present by looking at Acf plots. 


```{r, echo=FALSE, message=FALSE, warning=FALSE}
par(mfrow = c(3,2))
AcfE <- Acf(e.ts, main = "Acf Plot 'E'")
AcfF <- Acf(f.ts, main = "Acf Plot 'F'")
AcfO <- Acf(i.ts, main = "Acf Plot 'O'")
AcfM <- Acf(m.ts, main = "Acf Plot 'M'")
AcfN <- Acf(n.ts, main = "Acf Plot 'N'")
AcfS <- Acf(s.ts, main = "Acf Plot 'S'")

```

All items display stickiness on the Acf plots, meaning that there is some lag-1 trending that can probably be modeled. Additionally we see seasonality that can be modeled. 

**Are these data series random walks?**

We can determine this by hypothesis testing. 

We can say that E is not a random walk if we are using $\alpha = 0.05$

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#test for a random walk
fitE <- Arima(e.ts, order = c(1,0,0))
fitE
2*pt(-abs((1-fitE$coef["ar1"]) / 0.0587), df = length(e.ts)-1)
#normal distribution
2*pnorm(-abs((1 - fitE$coef["ar1"]) / 0.0587))

```


We can say that F is not a random walk if we are using $\alpha = 0.01$

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#test for a random walk
fitF <- Arima(f.ts, order = c(1,0,0))
fitF
pander(2*pt(-abs((1-fitF$coef["ar1"]) / 0.07996), df = length(f.ts)-1))
#normal distribution
pander(2*pnorm(-abs((1 - fitF$coef["ar1"]) / 0.07996)))

```


We can say that I is not a random walk if we are using $\alpha = 0.01$

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#test for a random walk
fitI <- Arima(i.ts, order = c(1,0,0))
fitI
pander(2*pt(-abs((1-fitI$coef["ar1"]) / 0.08599), df = length(i.ts)-1))
#normal distribution
pander(2*pnorm(-abs((1 - fitI$coef["ar1"]) / 0.08599)))
```


We can say that M IS a random walk if we are using $\alpha = 0.01$ because $p=0.08$ and therefore $p>\alpha$ if  $\alpha = 0.05$. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#test for a random walk
fitM <- Arima(m.ts, order = c(1,0,0))
fitM
pander(2*pt(-abs((1-fitM$coef["ar1"]) / 0.05895), df = length(m.ts)-1))
#normal distribution
pander(2*pnorm(-abs((1 - fitM$coef["ar1"]) / 0.05895)))

```

We can say that N is not a random walk if we are using $\alpha = 0.01$

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#test for a random walk
fitN <- Arima(n.ts, order = c(1,0,0))
fitN
pander(2*pt(-abs((1-fitN$coef["ar1"]) / 0.09314), df = length(n.ts)-1))
#normal distribution
pander(2*pnorm(-abs((1 - fitN$coef["ar1"]) / 0.09314)))

```

We can say that S is not a random walk if we are using $\alpha = 0.01$

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#test for a random walk
fitS <- Arima(s.ts, order = c(1,0,0))
fitS
pander(2*pt(-abs((1-fitS$coef["ar1"]) / 0.1239), df = length(m.ts)-1))
#normal distribution
pander(2*pnorm(-abs((1 - fitS$coef["ar1"]) / 0.1239)))

```


All of this leads us to veer in the direction of choosing forecasting models that accommodate trend and seasonality for all but one of the SKUs, M. However. Looking at the M plots that show trend and seasonality, it seems that those components are present and I therefore think it would be worth trying to model with methods other than the naive. 


###Step 3 

Forecast with the appropriate models. Also include a naive model to use as a baseline. I will model series and deploy forecasts for item E. The process for the other data sets is the same.  

**SS06S6T100144 - Item E**

Naive

```{r, echo=FALSE, message=FALSE, warning=FALSE}
validLengthE <- 12
trainLengthE <- length(e.ts) - validLengthE
salesTrainE <- window(e.ts, end = c(2012, trainLengthE))
salesValidE <- window(e.ts, start = c(2012, trainLengthE + 1))

#naive
naiveE <- snaive(salesTrainE, h = validLengthE)
#pointFC snaive 42/28 naive 29/14
naiveE$mean
#accuracy 43/21
accuracy(naiveE, salesValidE)
```

Exponential Smoothing

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#best smoothing model, it chooses an ANN model with a very small alpha meaning it's a slow learner.
etsE <- ets(salesTrainE, model = "ZZZ", restrict = FALSE)
etsE
summary(etsE)
etsForecastE <- forecast(etsE, h = validLengthE, level = 0)
etsForecastE
#accuracy 35/18
accuracy(etsForecastE, salesValidE)
```

Regression

```{r, echo=FALSE, message=FALSE, warning=FALSE}
seasonTrendE <- tslm(salesTrainE ~ trend + season)
#summary
summary(seasonTrendE)
#forecasting Regression Models
seasonRegEForecast <- forecast(seasonTrendE, h = validLengthE)
seasonRegEForecast
#accuracy 33/21
accuracy(seasonRegEForecast, salesValidE)
```

An Acf plot of the regression model shows some uncaptured trend and seasonality which we can further model. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
residualsseasonTrendE <- Acf(seasonTrendE$residuals, main = "Some Seasonality \nLeft to Capture")
```


```{r, message=FALSE, warning=FALSE, include=FALSE}
ARModel <- Arima(seasonTrendE$residuals, order = c(1,0,0))
ARModel
#calculate t stat, see it's not statistically significant, ar1 > 2
ARModel$coef["ar1"] / 0.1316
#residuals of residuals
Acf(ARModel$residuals)
#forecast residuals
errorForecast <- forecast(ARModel, h = validLengthE)
errorForecast
#improved Forecast MAPE = 20.22199
adjustedForecast <- seasonRegEForecast$mean + errorForecast$mean
adjustedForecast
accuracy(adjustedForecast, salesValidE)
```

This is the adjusted regression forecast and its accuracy. It's not much of an improvement, but since it appeared that there was more data to capture, it's important to try. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
adjustedForecast
accuracy(adjustedForecast, salesValidE)
```


**Use a Neural Network**

After we get a neural network forecast, we can model for uncaptured components to maybe improve the forecast. In this case, the forecast accuracy is the same. 

```{r, message=FALSE, warning=FALSE, include=FALSE}
set.seed(201)

neuralE <- nnetar(salesTrainE, p = 11)

neuralForecast <- forecast(neuralE, h = validLengthE)

```

The neural net has given the best MAPE scores during the test and the validation periods. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
neuralForecast$mean
#p=11, MAPE = 0.74/16.05
accuracy(neuralForecast, salesValidE)
```

Further modeling may be warranted

```{r, message=FALSE, warning=FALSE, include=FALSE}
ARModel <- Arima(neuralE$residuals, order = c(2,0,0))
ARModel
#calculate t stat, see it's not statistically significant, ar1 > 2
ARModel$coef["ar1"] / 0.1438
ARModel$coef["ar2"] / 0.1389
```

```{r, message=FALSE, warning=FALSE, include=FALSE}
#residuals of residuals
Acf(ARModel$residuals)
#forecast residuals
errorForecast <- forecast(ARModel, h = validLengthE)
errorForecast
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#improved Forecast MAPE = 16.05
adjustedForecast <- neuralForecast$mean + errorForecast$mean
adjustedForecast
accuracy(adjustedForecast, salesValidE)
```

However, we see the forecast accuracy is the same after working in the Acf residuals. This means the original model captured all the trend and seasonality. 


###Step 4 

Other Considerations

As we read earlier in the course, forecasts can be improved by averaging the forecasted valued from various models. Below is the average and the accuracy metrics. Although the accuracy is not ideal and not as good as the neural network, it would be interesting to test the model. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
allForecasts <- (naiveE$mean + etsForecastE$mean +seasonRegEForecast$mean + seasonRegEForecast$mean + neuralForecast$mean)/5
allForecasts
#MAPE of the averaged forecasts = 20.23421
accuracy(allForecasts, salesValidE)
```

This plot shows the original series in black; it is obscured by the neural net fit model. The forecasts are in dotted lines. 

```{r, echo=FALSE}

plot(f.ts, bty = "n", main = "Actual Use and Forecasting Models \nSS06S6T100144 ")
lines(naiveE$fitted, col = "blue")
lines(naiveE$mean, col = "blue", lty = 2)
lines(etsE$fitted, col = "green")
lines(etsForecastE$mean, col = "green", lty = 3)
lines(seasonTrendE$fitted, col = "orange")
lines(seasonRegEForecast$mean, col = "orange", lty = 4)
lines(neuralE$fitted, col = "red")
lines(neuralForecast$mean, col = "red",lty = 5)
lines(allForecasts, col = "purple")


legend(2012, 800, c("Naive", "ETS", "Regression", "Neural Net", "Average"), lty = c(1,1,1,1,1), lwd = c(1,1,1,1,1), bty = "n", col = c("black", "blue", "green", "orange", "red"))
```



**Has a similar problem been solved by others? If yes, then please cite those sources.**

Yes. Last semester, in Supply Chain with Professor Kohli, my team tackled inventory management at Sigco. We attempted to build a system using historical data to forecast several months out. With the forecasted values we used the Economic Order Quantity (EOQ) model to calculate safety stock and reorder points. I was tasked with the forecasting and EOQ calculations. I am a little embarrassed to tell exactly how I did this last semester, but the process was abbreviated, but now, armed with Predictive Analytics, I wanted to revisit the material for find the best forecasting model and I wanted to try and develop a systematic workflow to tackling various forecasting problems.








```{r, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
validLengthM <- 12
trainLengthM <- length(m.ts) - validLengthM
salesTrainM <- window(m.ts, end = c(2012, trainLengthM))
salesValidM <- window(m.ts, start = c(2012, trainLengthM + 1))

summary(LinearM)

#naive
naiveM <- snaive(salesTrainM, h = validLengthM)
#pointFC
naiveM$mean
#accuracy 81/34
accuracy(naiveM, salesValidM)


```

```{r, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
validLengthN <- 12
trainLengthN <- length(n.ts) - validLengthN
salesTrainN <- window(n.ts, end = c(2012, trainLengthN))
salesValidN <- window(n.ts, start = c(2012, trainLengthN + 1))

summary(LinearN)
#naive
naiveN <- snaive(salesTrainN, h = validLengthN)
#pointFC
naiveN$mean
#accuracy 17/13
accuracy(naiveN, salesValidN)

```

```{r, message=FALSE, warning=FALSE, include=FALSE}
validLengthS <- 12
trainLengthS <- length(s.ts) - validLengthS
salesTrainS <- window(s.ts, end = c(2012, trainLengthS))
salesValidS <- window(s.ts, start = c(2012, trainLengthS + 1))
```

```{r, message=FALSE, warning=FALSE, include=FALSE}

summary(seasonTrendS)
```

```{r, message=FALSE, warning=FALSE, include=FALSE}
#Autocorrelation
AcfS <- Acf(s.ts)
#Acf for Differenced and there appears to be some uncaptured seasonality
Acf(diff(s.ts, lag = 1), lag.max = 12, main = "Acf Plot for Differenced Item S")
plot(diff(s.ts, lag = 1, bty = "l", main = "Uncaptured Seasonality in Differenced \nItem S Monthly Data"))
abline(h = 0)
#test for a random walk
fitS <- Arima(s.ts, order = c(1,0,0))
fitS
2*pt(-abs((1-fitS$coef["ar1"]) / 0.1239), df = length(s.ts)-1)
#normal distribution
2*pnorm(-abs((1 - fitS$coef["ar1"]) / 0.1239))

#Since $p<\alpha$ we know this series is not a random walk
```


```{r, message=FALSE, warning=FALSE, include=FALSE}

#naive
naiveS <- snaive(salesTrainS, h = validLengthS)
#pointFC
naiveS$mean
#accuracy 43/21
accuracy(naiveS, salesValidS)
```

```{r, message=FALSE, warning=FALSE, include=FALSE}
#trailing
trailMAS <- rollmean(salesTrainS, k = 12, align = "right")
trailSForecast <- trailMAS[1]
trailSForecast
accuracy(trailSForecast, salesValidS[1])
#look for trend and seasonality with Acf
```

```{r, message=FALSE, warning=FALSE, include=FALSE}
#best smoothing model, it chooses an ANN model with a very small alpha meaning it's a slow learner.
etsS <- ets(salesTrainS, model = "ZZZ", restrict = FALSE)
etsS
summary(etsS)
etsForecastS <- forecast(etsS, h = validLengthS, level = 0)
etsForecastS
#accuracy 42/24
accuracy(etsForecastS, salesValidS)
plot(s.ts, main = "Smoothing Model S", bty = "l")
lines(etsS$fitted, col = "blue", lty = 1,lwd = 2)
#lines(etsSANN$fitted, col = "green", lty = 1,lwd = 2)
```


```{r, message=FALSE, warning=FALSE, include=FALSE}
seasonTrendS <- tslm(salesTrainS ~ trend + season)
#summary
summary(seasonTrendS)
#forecasting Regression Models
seasonRegSForecast <- forecast(seasonTrendS, h = validLengthS)
seasonRegSForecast
#accuracy 30/25
accuracy(seasonRegSForecast, salesValidS)
```



```{r, message=FALSE, warning=FALSE, include=FALSE}
residualsseasonTrendS <- Acf(seasonTrendS$residuals)
```


```{r, message=FALSE, warning=FALSE, include=FALSE}
ARModel <- Arima(seasonTrendS$residuals, order = c(1,0,0))
ARModel
#calculate t stat, see it's not statistically significant
ARModel$coef["ar1"] / 0.1359
#residuals of residuals
Acf(ARModel$residuals)
#forecast residuals
errorForecast <- forecast(ARModel, h = validLengthS)
errorForecast
#improved Forecast MAPE = 25.27023
adjustedForecast <- seasonRegSForecast$mean + errorForecast$mean
adjustedForecast
accuracy(adjustedForecast, salesValidS)
```


```{r, message=FALSE, warning=FALSE, include=FALSE}
set.seed(201)

neuralS <- nnetar(salesTrainS, p = 11)

neuralForecast <- forecast(neuralS, h = validLengthS)
neuralForecast$mean
accuracy(neuralForecast, salesValidS)
neuralSP <- nnetar(salesTrainS, P = 1)

neuralForecastSP <- forecast(neuralSP, h = validLengthS)
neuralForecastSP$mean
accuracy(neuralForecastSP, salesValidS)


```

```{r, message=FALSE, warning=FALSE, include=FALSE}
allForecasts <- (neuralForecastSP$mean + seasonRegSForecast$mean + etsForecastS$mean + naiveS$mean)/4
allForecasts
accuracy(allForecasts, salesValidS)

allForecasts <- as.numeric(allForecasts)

```



```{r, message=FALSE, warning=FALSE, include=FALSE}
validLengthE <- 12
trainLengthE <- length(f.ts) - validLengthE
salesTrainE <- window(f.ts, end = c(2012, trainLengthE))
salesValidE <- window(f.ts, start = c(2012, trainLengthE + 1))
#naive
naiveE <- snaive(salesTrainE, h = validLengthE)
#pointFC snaive 22/13 naive 21/14
naiveE$mean
#accuracy 43/21
accuracy(naiveE, salesValidE)

#best smoothing model, it chooses an MNN model with an alpha = 0.4392.
etsE <- ets(salesTrainE, model = "ZZZ", restrict = FALSE)
etsE
summary(etsE)
etsForecastE <- forecast(etsE, h = validLengthE, level = 0)
etsForecastE
#accuracy 18/11.5

seasonTrendE <- tslm(salesTrainE ~ trend + season)
#summary
summary(seasonTrendE)
#forecasting Regression Models
seasonRegEForecast <- forecast(seasonTrendE, h = validLengthE)
seasonRegEForecast
#accuracy 17/12
accuracy(seasonRegEForecast, salesValidE)

residualsseasonTrendE <- Acf(seasonTrendE$residuals, main = "Some Seasonality \nLeft to Capture")

ARModel <- Arima(seasonTrendE$residuals, order = c(1,0,0))
ARModel
#calculate t stat, see it's significant, ar1 > 2
ARModel$coef["ar1"] / 0.1277
#residuals of residuals
Acf(ARModel$residuals)
#forecast residuals
errorForecast <- forecast(ARModel, h = validLengthE)
errorForecast
#improved Forecast MAPE = 12.32389
adjustedForecast <- seasonRegEForecast$mean + errorForecast$mean
adjustedForecast
accuracy(adjustedForecast, salesValidE)

adjustedForecast

set.seed(201)

neuralE <- nnetar(salesTrainE, p = 11)

neuralForecast <- forecast(neuralE, h = validLengthE)

neuralForecast$mean
#p=11, MAPE = 0.166/15.876

ARModel <- Arima(neuralE$residuals, order = c(1,0,0))
ARModel
#calculate t stat, see it's not statistically significant, ar1 <2
ARModel$coef["ar1"] / 0.1979

#residuals of residuals
Acf(ARModel$residuals)
#forecast residuals
errorForecast <- forecast(ARModel, h = validLengthE)
errorForecast

# Not improved Forecast MAPE = 15.87759
adjustedForecast <- neuralForecast$mean + errorForecast$mean
adjustedForecast
accuracy(adjustedForecast, salesValidE)
```

**SS10CLR96130 - Item F**

Naive

```{r, echo=FALSE, message=FALSE, warning=FALSE}
accuracy(naiveE, salesValidE)
```


Smoothing

```{r, echo=FALSE, message=FALSE, warning=FALSE}
accuracy(etsForecastE, salesValidE)
```

Regression 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
accuracy(seasonRegEForecast, salesValidE)
```

Adjusted Regression

```{r, echo=FALSE, message=FALSE, warning=FALSE}
accuracy(adjustedForecast, salesValidE)
adjustedForecast
```

Neural Net

```{r, echo=FALSE, message=FALSE, warning=FALSE}
accuracy(neuralForecast, salesValidE)
```


A forecast averaged from the forecastscreated shows a slight improvement for Item F with a MAPE = 11.82 %

```{r, echo=FALSE, message=FALSE, warning=FALSE}
allForecasts <- (naiveE$mean + etsForecastE$mean + adjustedForecast +seasonRegEForecast$mean + seasonRegEForecast$mean + neuralForecast$mean)/6
allForecasts
#MAPE of the averaged forecasts = 11.87
accuracy(allForecasts, salesValidE)
```

This plot shows the original series in black; it is obscured by the neural net fit model. The forecasts are in dotted lines. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}

plot(f.ts, bty = "n", main = "Actual Use and Forecasting Models \nSS06S6T100144 ")
lines(naiveE$fitted, col = "blue")
lines(naiveE$mean, col = "blue", lty = 2)
lines(etsE$fitted, col = "green")
lines(etsForecastE$mean, col = "green", lty = 3)
lines(seasonTrendE$fitted, col = "orange")
lines(seasonRegEForecast$mean, col = "orange", lty = 4)
lines(neuralE$fitted, col = "red")
lines(neuralForecast$mean, col = "red",lty = 5)
lines(allForecasts, col = "purple")


legend(2012, 800, c("Naive", "ETS", "Regression", "Neural Net", "Average"), lty = c(1,1,1,1,1), lwd = c(1,1,1,1,1), bty = "n", col = c("black", "blue", "green", "orange", "red"))
```




```{r, message=FALSE, warning=FALSE, include=FALSE}
validLengthE <- 12
trainLengthE <- length(f.ts) - validLengthE
salesTrainE <- window(f.ts, end = c(2012, trainLengthE))
salesValidE <- window(f.ts, start = c(2012, trainLengthE + 1))
#naive
naiveE <- snaive(salesTrainE, h = validLengthE)
#pointFC snaive 22/13 naive 21/14
naiveE$mean
#accuracy 43/21
accuracy(naiveE, salesValidE)

#best smoothing model, it chooses an MNN model with an alpha = 0.4392.
etsE <- ets(salesTrainE, model = "ZZZ", restrict = FALSE)
etsE
summary(etsE)
etsForecastE <- forecast(etsE, h = validLengthE, level = 0)
etsForecastE
#accuracy 18/11.5

seasonTrendE <- tslm(salesTrainE ~ trend + season)
#summary
summary(seasonTrendE)
#forecasting Regression Models
seasonRegEForecast <- forecast(seasonTrendE, h = validLengthE)
seasonRegEForecast
#accuracy 17/12
accuracy(seasonRegEForecast, salesValidE)

residualsseasonTrendE <- Acf(seasonTrendE$residuals, main = "Some Seasonality \nLeft to Capture")

ARModel <- Arima(seasonTrendE$residuals, order = c(1,0,0))
ARModel
#calculate t stat, see it's significant, ar1 > 2
ARModel$coef["ar1"] / 0.1277
#residuals of residuals
Acf(ARModel$residuals)
#forecast residuals
errorForecast <- forecast(ARModel, h = validLengthE)
errorForecast
#improved Forecast MAPE = 12.32389
adjustedForecast <- seasonRegEForecast$mean + errorForecast$mean
adjustedForecast
accuracy(adjustedForecast, salesValidE)

adjustedForecast

set.seed(201)

neuralE <- nnetar(salesTrainE, p = 11)

neuralForecast <- forecast(neuralE, h = validLengthE)

neuralForecast$mean
#p=11, MAPE = 0.166/15.876

ARModel <- Arima(neuralE$residuals, order = c(1,0,0))
ARModel
#calculate t stat, see it's not statistically significant, ar1 <2
ARModel$coef["ar1"] / 0.1979

#residuals of residuals
Acf(ARModel$residuals)
#forecast residuals
errorForecast <- forecast(ARModel, h = validLengthE)
errorForecast

# Not improved Forecast MAPE = 15.87759
adjustedForecast <- neuralForecast$mean + errorForecast$mean
adjustedForecast
accuracy(adjustedForecast, salesValidE)
```

**SS10CLR96130 - Item F**

Naive

```{r, echo=FALSE, message=FALSE, warning=FALSE}
accuracy(naiveE, salesValidE)
```


Smoothing

```{r, echo=FALSE, message=FALSE, warning=FALSE}
accuracy(etsForecastE, salesValidE)
```

Regression 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
accuracy(seasonRegEForecast, salesValidE)
```

Adjusted Regression

```{r, echo=FALSE, message=FALSE, warning=FALSE}
accuracy(adjustedForecast, salesValidE)
adjustedForecast
```

Neural Net

```{r, echo=FALSE, message=FALSE, warning=FALSE}
accuracy(neuralForecast, salesValidE)
```


A forecast averaged from the forecastscreated shows a slight improvement for Item F with a MAPE = 11.82 %

```{r, echo=FALSE, message=FALSE, warning=FALSE}
allForecasts <- (naiveE$mean + etsForecastE$mean + adjustedForecast +seasonRegEForecast$mean + seasonRegEForecast$mean + neuralForecast$mean)/6
allForecasts
#MAPE of the averaged forecasts = 11.87
accuracy(allForecasts, salesValidE)
```

This plot shows the original series in black; it is obscured by the neural net fit model. The forecasts are in dotted lines. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}

plot(f.ts, bty = "n", main = "Actual Use and Forecasting Models \nSS06S6T100144 ")
lines(naiveE$fitted, col = "blue")
lines(naiveE$mean, col = "blue", lty = 2)
lines(etsE$fitted, col = "green")
lines(etsForecastE$mean, col = "green", lty = 3)
lines(seasonTrendE$fitted, col = "orange")
lines(seasonRegEForecast$mean, col = "orange", lty = 4)
lines(neuralE$fitted, col = "red")
lines(neuralForecast$mean, col = "red",lty = 5)
lines(allForecasts, col = "purple")


legend(2012, 800, c("Naive", "ETS", "Regression", "Neural Net", "Average"), lty = c(1,1,1,1,1), lwd = c(1,1,1,1,1), bty = "n", col = c("black", "blue", "green", "orange", "red"))
```




